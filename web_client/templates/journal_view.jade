mixin revisionOption(value,selectedRev)
  option(class="revisionOption" value=value._id) #{value.name}

mixin searchLink(value,type)
  a(href='#plugins/journal?query="'+type+'":"'+ value+ '"') #{value}

mixin existingComment(commentInfo)
  div(class="aComment" style="")
      img(class="commentThumbnail")
      a(class="commentUserName")
        | #{commentInfo.name}
      span(class="commentDate")
      a(class="deleteCommentLink" val=commentInfo.index)
        | Remove Comment
      div(class="commentTextDiv")
        span(class="commentText")
          | #{commentInfo.text}

mixin deleteCommentConfirmation()
  div#deleteCommentConfirmation
    div(style="float:right; margin-top:20px")
    input(class="globalButton deleteCommentYes" type="button" value="Yes")
    input(class="globalButton deleteCommentNo" type="button" value="Cancel")

div#headerBar
div(class="Wrapper")
  div(class="Content")
    div(class="ContentWithRightPanel")
      div(class="Panel")
        h4 Resources
          ul
            li
              a#downloadLink Download
        h4 Export citation:
        h4 Statistics:
        h4 Information
          ul
            li Type: #{info.revision.meta.type}
            li Categories:
            li Keywords:
              each item in info.revision.meta.tags
                +searchLink(item,'tags')
                |,
            if info.otherRevisions
              li Current revision:
                select#revisionSelector
                    for value in info.otherRevisions
                      selected=""
                      if value == info.revision._id
                        selected = "selected=''"
                      +revisionOption(value,selected)

            li License: #{info.parent.meta.source-license}
            if info.parent.meta.grant
              li Grant: #{info.parent.meta.grant}
        h4 Share
        if user.attributes.admin
          h4 Manage
          ul
            li
              a(href="#plugins/journal/submission/"+info.revision._id+"/revision") New Revision
            li
              a(href="#plugins/journal/submission/"+info.revision._id+"/edit") Edit Resource
            li
              a Delete Resource
            if info.parent.meta.prevRevis
              li
                 a Delete Current revision
            li
              a Manage Reviews

      div(class="MainContent")
        div#publication
          br
          div(class="title").
            #{info.parent.name}
          div(class="authors")
            each item in info.revision.meta.authors
              +searchLink(item,'authors')
              |,
          div(class="institution")
              +searchLink(info.revision.meta.institution,"institution")
          div(class="journal").
            Submitted to: #{info.parent.baseParentId}
          div(class="submittedby").
            Submitted by #{info.parent.creatorId} on #{info.parent.created}
          if info.revision.description
              h4 Revision Notes
              div(class="abstract" style="text-align: justify")
                | #{info.revision.description}
          div(class="abstract").
            #{info.parent.description}
          h4 Comments
          div#commentsContainer
            div#commentsDiv
              if user
                  div(class="addCommentWrapper")
                    div#addCommentDiv
                      textarea#commentText(maxlength="1200" placeholder="Write a comment..." style="height:50px; width:595px")
                      div(class="addCommentFooter" style="")
                        div(class="commentLimit")
                          div(class="commentLimitString")
                            div(class="commentLengthRemaining")
                              | 1200 characters remaining.
                        div(class="commentAs")
                          div(class="postingAsString")
                            | posting as #{user.name()}
                            span#postingAsUsername
                        input#addCommentButton(class="globalButton" type="button" value="Post")
              else
                  div(class="loginToComment")
                    span
                      a#loginToComment(href='#plugins/journal?dialog=login') Login
                      |  or
                      a#registerToComment(href='#plugins/journal?dialog=register') register
                      |  to add a comment
              div#existingCommentsList
                for comment in info.parent.meta.comments
                  if comment.name
                    +existingComment(comment)
                div(class="commentsBottomMessage")
                  script.
                    $(".commentsBottomMessage").text($(".aComment").length +" comments on this item")
              div(class="commentPaginateWrapper")
