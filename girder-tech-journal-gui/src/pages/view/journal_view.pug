mixin revisionOption(value,selectedRev,submission)
  tr(class=selectedRev, data-href=value.meta.revisionNumber data-submission=submission.meta.submissionNumber)
      td
        div.
          #{value.name}
      td
        div.
          #{value.submitter.firstName} #{value.submitter.lastName}
      td
        div.
          #{value.created}
      td
        div.
          #{value.meta.certification_level}
      td
        div.
          #{value.description}

mixin searchLink(value,type)
  a(href='#?query="'+type+'":["'+ value+ '"]') #{value}

mixin existingComment(commentInfo)
  .aComment(style="")
    img.commentThumbnail
    a.commentUserName
      | #{commentInfo.name}
    span.commentDate
    if user
      if (user.attributes.admin)
        a.deleteCommentLink(val=commentInfo.index)
          | Remove Comment
    .commentTextDiv
      span.commentText
        | #{commentInfo.text}

mixin deleteCommentConfirmation()
  #deleteCommentConfirmation
    div(style="float:right; margin-top:20px")
    input.globalButton.deleteCommentYes(type="button", value="Yes")
    input.globalButton.deleteCommentNo(type="button", value="Cancel")

-  var downloadCount=0
-  var viewCount=0
if 'downloadStatistics' in info.revision
  - downloadCount = info.revision.downloadStatistics.completed
  - viewCount = info.revision.downloadStatistics.views

#headerBar
.Wrapper
  .Content
    .ContentWithRightPanel
      .Panel
        h4 Resources
        ul
          li
            a#downloadLink Download
        if info.revision.meta.github
          p#githubDisclaimer
            span(style="color:red;") Caution:
            | Github repository may have been updated since submission
          ul
            li
              a(href=info.revision.meta.github) GitHub
        h4 Export citation:
        ul
          li
            select#exportCitType(name="exportType")
              option.citOption(value="bibtex") Bibtext
              option.citOption(value="xml") XML
            input.exportCit(type="submit", value="Export")
          textarea.citationDisplay(style="display: none;")
        h4 Statistics:
        ul
          li Views: #{viewCount}
          li Downloads: #{downloadCount}
        h4 Information
        ul
          li Type: #{info.revision.meta.type}
          li Categories:&nbsp;
            each item in info.revision.meta.categories
              +searchLink(item,"category")
              |,&nbsp;
          li Keywords:&nbsp;
            each item in info.revision.meta.tags
              +searchLink(item,'tags')
              |,&nbsp;
          li License: #{info.revision.meta["source-license"]}
          if info.parent.meta.grant
            li Grant: #{info.parent.meta.grant}
        h4 Share
        if user
          if (user.attributes.admin) || (info.parent.creatorId===user.id)
            h4 Manage
            ul
              li
                a(href="#plugins/journal/submission/"+info.revision._id+"/revision") New Revision
              if (user.attributes.admin)
                li
                  a(href="#plugins/journal/submission/"+info.revision._id+"/edit") Edit current revision
                if info.otherRevisions.length > 1
                  li
                    a#deleteRevision Delete Current revision
                li
                  a#deleteSubmission Delete publication
                li
                  a#manageReviews Manage Reviews

      .MainContent
        #publication
          .pubHeader
            h1.title.
              #{info.parent.name}
            .pubInfo
              .revision
                b #{info.revision.name}
              span.authors
                each item in info.revision.meta.authors
                  +searchLink(item,'authors')
                  |,&nbsp;
              span.institution
                +searchLink(info.revision.meta.institution,"institution")
              span.identifier
                | Please use this identifier to cite or link to this publication:
                a(href=urlLink)  #{urlLink}
            img.ResultLogo(src=logo)
          unless info.revision.curation.status === "APPROVED"
            span(style="font-weight:bold;color:red;")
              | This article is waiting for approval
          .journal
            | Submitted to&nbsp;
            a(href="#?issueId=" + info.parent.issue._id) #{info.parent.issue.name}
            span.submittedby.
              &nbsp;by #{info.revision.submitter.firstName} #{info.revision.submitter.lastName} on #{info.parent.created}
          .abstract.
            #{info.parent.description}
          if info.revision.description
            .revision_notes
              h4 Revision Notes
              .abstract(style="text-align: justify")
                | #{info.revision.description}
          div
            table#revisionTable(width="100%")
              thead
                tr
                  th.
                    Revision Version
                  th.
                    Submitted By
                  th.
                    Submission Date
                  th.
                    Certified
                  th.
                    Notes
              tbody
                if info.otherRevisions
                  for value in info.otherRevisions
                    - selected="clickable-row"
                    if value._id === info.revision._id
                      - selected="selected"
                    +revisionOption(value,selected,info.parent)
          h4(style="padding-bottom: 10px;") Comments
          #commentsContainer
            #commentsDiv
              if user
                .addCommentWrapper
                  #addCommentDiv
                    textarea#commentText(maxlength="1200", placeholder="Write a comment...", style="height:50px; width:595px")
                    .addCommentFooter(style="")
                      .commentLimit
                        .commentLimitString
                          .commentLengthRemaining
                            | 1200 characters remaining.
                      .commentAs
                        .postingAsString
                          | posting as #{user.name()}
                          span#postingAsUsername
                      input#addCommentButton.globalButton(type="button", value="Post")
              else
                .loginToComment
                  span
                    a#loginToComment(href='#?dialog=login') Login
                    |  or
                    a#registerToComment(href='#?dialog=register') register
                    |  to add a comment
              #existingCommentsList
                for comment in info.parent.meta.comments
                  if comment.name
                    +existingComment(comment)
                .commentsBottomMessage #{info.parent.meta.comments.length} comments on this item
              .commentPaginateWrapper
